# üìå –¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ: –°–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å —Ä–æ—Å—Ç–æ–º –≤ DevOps

## üéØ –¶–µ–ª—å

–û—Ü–µ–Ω–∏—Ç—å:

- –¢–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É
- –ü–æ–¥—Ö–æ–¥ –∫ —Ä–µ—à–µ–Ω–∏—é –∑–∞–¥–∞—á
- –ü–æ–Ω–∏–º–∞–Ω–∏–µ DevOps-–ø—Ä–∞–∫—Ç–∏–∫

---

## üì¶ –§–æ—Ä–º–∞—Ç —Å–¥–∞—á–∏

- –£–ø–∞–∫–æ–≤–∞—Ç—å –≤—Å—ë –≤ –∞—Ä—Ö–∏–≤ –∏–ª–∏ –æ—Ñ–æ—Ä–º–∏—Ç—å –∫–∞–∫ git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- –ü—Ä–∏–ª–æ–∂–∏—Ç—å `README.md`, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π:
  - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ –∑–∞–ø—É—Å–∫—É
  - –ö—Ä–∞—Ç–∫–∏–µ –ø–æ—è—Å–Ω–µ–Ω–∏—è –∫ –∫–∞–∂–¥–æ–º—É –ø—É–Ω–∫—Ç—É

---

## ‚è≥ –°—Ä–æ–∫–∏

- –ù–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞—ë—Ç—Å—è **3 –¥–Ω—è** —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è
- –û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è ‚Äî **4‚Äì6 —á–∞—Å–æ–≤** –¥–ª—è —É–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞
- –ù–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–≤–æ–¥–∏—Ç—å –¥–æ —É—Ä–æ–≤–Ω—è production ‚Äî –≤–∞–∂–µ–Ω **–ø–æ–¥—Ö–æ–¥ –∫ —Ä–µ—à–µ–Ω–∏—é –∑–∞–¥–∞—á**

‚ö†Ô∏è –ú–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ 2‚Äì3 –∑–∞–¥–∞–Ω–∏—è, –Ω–æ **–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç** ‚Äî `Docker + Ansible + Bash`

---

## ‚úÖ –ó–∞–¥–∞–Ω–∏—è

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Docker

–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–æ–µ–∫—Ç –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

- `PostgreSQL`
- `Redis`
- `nginx` (–ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ `php-fpm`)
- `PHP` (–≤–µ—Ä—Å–∏—è 8.1+)
  - –ü—Ä–∏–º–µ—Ä —Å–∫—Ä–∏–ø—Ç–∞: [–°—Å—ã–ª–∫–∞ –Ω–∞ PHP-—Å–∫—Ä–∏–ø—Ç](https://disk.360.yandex.ru/d/m87BkKigYk7Wag)

### –û–∂–∏–¥–∞–µ—Ç—Å—è:

- `docker-compose.yml`, –∑–∞–ø—É—Å–∫–∞–µ–º—ã–π –∫–æ–º–∞–Ω–¥–æ–π:
  ```bash
  docker compose up -d

# –†–µ—à–µ–Ω–∏–µ:
1. –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–∞–∫–∏–µ –ø–∞–ø–∫–∏ –∫–∞–∫ "nginx", "php", "src".
2. –î–∞–ª–µ–µ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å Dockerfile –≤ –ø–∞–ø–∫–µ php

![Dockerfile for php](images/dockerfile_php.jpg)

3. –î–∞–ª–µ–µ —Å–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª nginx.conf –∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –µ–≥–æ –≤ –ø–∞–ø–∫–µ nginx.

![Dockerfile for php](images/nginxconf.jpg)

4. –í –ø–∞–ø–∫–µ src —Ä–∞–∑–∞—Ä—Ö–∏–≤–∏—Ä—É–µ–º –Ω–∞—à index.php

5. –î–∞–ª–µ–µ —Å–æ–∑–¥–∞–µ–º docker-compose.yml –∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –µ–≥–æ —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–∞—à–∏–º —Å–µ—Ä–≤–∏—Å–∞–º. –ü—Ä–æ–ø–∏—Å—ã–≤–∞–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, —Ç–∞–∫–∂–µ –≤—Å–µ –ø–∞—Ä–æ–ª–∏ –∏ –ª–æ–≥–∏–Ω—ã –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–¥ –∏ –Ω–µ –∑–∞–±—ã–≤–∞–µ–º –ø—Ä–æ –ø–æ—Ä—Ç—ã.

![Dockerfile for php](images/dockercompose1.jpg)

![Dockerfile for php](images/dockercompose2.jpg)

6. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∑–∞–ø—É—Å–∫–∞–µ–º –Ω–∞—à docker-compose.yml –∫–æ–º–∞–Ω–¥–æ–π "docker compose up -d"

![Dockerfile for php](images/startdockercompose.jpg)

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–±–æ—Ç—ã –Ω–∞—à–∏—Ö –ø–æ–¥–Ω—è—Ç—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:

![Dockerfile for php](images/nginxwork.jpg)

![Dockerfile for php](images/dbcontainer.jpg)



### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (–ø–ª—é—Å–æ–º)

–î–æ–±–∞–≤—å—Ç–µ Prometheus –∏ Grafana –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.

### –û–∂–∏–¥–∞–µ—Ç—Å—è:

- `Docker Compose –¥–æ–ø–æ–ª–Ω–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å–∞–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞`
- `–ö–æ–Ω—Ñ–∏–≥ Prometheus (—Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ c Nginx)`
- `–û–¥–∏–Ω –ø—Ä–∏–º–µ—Ä –¥–∞—à–±–æ—Ä–¥–∞ –≤ Grafana (JSON –∏–ª–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç)`

# –†–µ—à–µ–Ω–∏–µ:

1. –î–æ–ø–æ–ª–Ω—è–µ–º –Ω–∞—à docker-compose.yml –¥–ª—è prometheus –∏ grafana.

![Dockerfile for php](images/grafanaprometheus.jpg)

2. –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–∞—à docker-compose.yml –∏ –≤–∏–¥–∏–º —á—Ç–æ –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–æ–¥–Ω—è–ª–∏—Å—å –≤ —Ç–æ–º —á–∏—Å–ª–µ prometheus –∏ grafana.

![Dockerfile for php](images/containers.jpg)

3. –î–∞–ª–µ–µ –º–æ–∂–µ–º –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –ø–æ localhost –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –Ω–∞—à prometheus –∏ grafana, –∑–∞—Ç–µ–º –≤—ã–±—Ä–∞—Ç—å –¥–∞—à–±–æ—Ä–¥ –∏ —É–≤–∏–¥–µ—Ç—å —á—Ç–æ –æ–Ω–∏ –æ–±–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω—ã –º–µ–∂–¥—É —Å–æ–±–æ–π –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —Å–ª—É–∂–∞—Ç –º–µ—Ç—Ä–∏–∫–∏ –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–≤–æ–¥—è—Ç—Å—è –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ:

![Dockerfile for php](images/metrics1.jpg)

![Dockerfile for php](images/metrics2.jpg)

![Dockerfile for php](images/metrics3.jpg)

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ:

![Dockerfile for php](images/nginxexporter.jpg)

![Dockerfile for php](images/promgrafana.jpg)



### 3. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ Ansible-–ø–ª–µ–π–±—É–∫–∞

–ù–∞–ø–∏—à–∏—Ç–µ Ansible-–ø–ª–µ–π–±—É–∫, –∫–æ—Ç–æ—Ä—ã–π:

- `–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç docker`
- `C–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å git`
- `–ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞ —á–µ—Ä–µ–∑ docker compose up -d`

### –û–∂–∏–¥–∞–µ—Ç—Å—è:

- `Ansible-–ø–ª–µ–π–±—É–∫`

1. –î–ª—è –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ —è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª vagrant, –º–Ω–µ —É–¥–æ–±–Ω–æ –ø–æ–¥–Ω–∏–º–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã —á–µ—Ä–µ–∑ –Ω–µ–≥–æ. –í–æ—Ç –ø—Ä–∏–º–µ—Ä –º–æ–µ–≥–æ Vagrantfile:

![Dockerfile for php](images/vagrantfile.jpg)

2. –î–∞–ª–µ–µ –ø–æ–∫–¥–ª—é—á–∞–µ–º—Å—è –∫ –Ω–∞—à–µ–π –≤–∏—Ä—Ç–∞—É–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã vagrant ssh manager –∏ –∑–∞—Ö–æ–¥–∏–º –≤ –Ω–∞—à—É –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É.

3. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Å–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª inventory –≤ –∫–æ—Ç–æ—Ä–æ–º –ø—Ä–æ–ø–∏—Å–∞–Ω ip-–∞–¥—Ä–µ—Å –Ω–∞—à–µ–π –≤–∏—Ä—Ç–∞—É–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã –∏ –ø—É—Ç—å –∫ ssh –∫–ª—é—á—É. –î–∞–ª–µ–µ —Å–æ–∑–¥–∞–µ–º –Ω–∞—à playbook.yml:

![Dockerfile for php](images/playbook_1.jpg)

![Dockerfile for php](images/playbook_2.jpg)

4. –î–∞–ª–µ–µ –∑–∞–ø—É—Å–∫–∞–µ–º –Ω–∞—à playbook —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã ansible-playbook -i inventory playbook.yml –∏ –≤–∏–¥–∏–º —É—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞—à–µ–≥–æ playbook.yml:

![Dockerfile for php](images/playbookwork.jpg)

5. –î–∞–ª–µ–µ –∑–∞—Ö–æ–¥–∏–º –Ω–∞ –Ω–∞—à—É –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã vagrant ssh manager –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—è–≤–∏–ª–∏—Å—å –ª–∏ –Ω–∞—à–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã –ª–∏ –æ–Ω–∏ –∞ —Ç–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã curl:

![Dockerfile for php](images/curlservices1.jpg)

![Dockerfile for php](images/curlservices2.jpg)



### 4. –ú–∏–Ω–∏-–∑–∞–¥–∞—á–∞ –ø–æ bash

–ù–∞–ø–∏—à–∏—Ç–µ bash-—Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π:

- `–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ—Ä—Ç–∞ –Ω–∞ IP (–Ω–∞–ø—Ä–∏–º–µ—Ä, host:port)`
- `–í —Å–ª—É—á–∞–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ ‚Äî –ø–∏—à–µ—Ç –ª–æ–≥ –≤ —Ñ–∞–π–ª`
- `[–ø–ª—é—Å–æ–º] –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–∫–∞–∑–∞–Ω–∏—è host –∏ port —á–µ—Ä–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∑–∞–ø—É—Å–∫–∞`

### –û–∂–∏–¥–∞–µ—Ç—Å—è:

- `bash-—Å–∫—Ä–∏–ø—Ç`

1. –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –∏ –Ω–∞–∑—ã–≤–∞–µ–º –µ–≥–æ check_port.sh

![Dockerfile for php](images/bash.jpg)

2. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞—à–µ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞:

–ü–æ–¥–Ω–∏–º–∞–µ–º –Ω–∞—à–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ –≤–≤—ã–ø–æ–ª–Ω—è–µ–º –Ω–∞—à —Å–∫—Ä–∏–ø—Ç

![Dockerfile for php](images/bashwork1.jpg)

–î–∞–ª–µ–µ –≤—ã–∫–ª—é—á–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç—É –Ω–∞—à–µ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞:

![Dockerfile for php](images/bashwork2.jpg)

–¢–∞–∫–∂–µ –≤–∏–¥–∏–º —á—Ç–æ —É –Ω–∞—Å –ø–æ—è–≤–∏–ª—Å—è —Ñ–∞–π–ª port_check.log –≤ –∫–æ—Ç–æ—Ä–æ–º –∑–∞–ø–∏—Å–∞–Ω—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –ø–æ–¥–Ω—è–ª–∏—Å—å.

![Dockerfile for php](images/bashwork3.jpg)